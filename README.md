# Discord Last.fm Now Playing

Last.fm APIã‚’ä½¿ç”¨ã—ã¦Discordã®ãƒªãƒƒãƒãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹ã«ç¾åœ¨å†ç”Ÿä¸­ã®æ¥½æ›²ã‚’è¡¨ç¤ºã—ã€Discord Botã§ãƒãƒ£ãƒ³ãƒãƒ«é€šçŸ¥ã¨çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆã‚’é€ä¿¡ã™ã‚‹TypeScriptã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

## ğŸµ æ©Ÿèƒ½

- âœ… **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¥½æ›²æƒ…å ±å–å¾—**: Last.fm APIã‹ã‚‰ç¾åœ¨å†ç”Ÿä¸­ã®æ¥½æ›²æƒ…å ±ã‚’å–å¾—
- âœ… **ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆæƒ…å ±**: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»No.1ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãƒ»No.1ãƒˆãƒ©ãƒƒã‚¯ã®çµ±åˆæƒ…å ±
- âœ… **å†ç”Ÿå±¥æ­´å–å¾—**: ç›´è¿‘ä½•ä»¶ã®å†ç”Ÿå±¥æ­´ã‚’æœŸé–“æŒ‡å®šãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œã§å–å¾—
- âœ… **Discord Rich Presenceæ›´æ–°**: æ¥½æ›²æƒ…å ±ã‚’Discordã®ãƒªãƒƒãƒãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹ã¨ã—ã¦è¡¨ç¤º
- âœ… **Discord Boté€šçŸ¥**: æ¥½æ›²ãŒå¤‰ã‚ã£ãŸæ™‚ã«ãƒãƒ£ãƒ³ãƒãƒ«ã¸é€šçŸ¥
- âœ… **è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**: æ—¥æ¬¡/é€±æ¬¡/æœˆæ¬¡ã®éŸ³æ¥½çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•é€ä¿¡
- âœ… **è¦–è¦šçš„ãƒ¬ãƒãƒ¼ãƒˆ**: 4ç¨®é¡ã®ã‚°ãƒ©ãƒ•ã‚’1æšã®ç™½èƒŒæ™¯ç”»åƒã«çµ±åˆ
- âœ… **Webã‚µãƒ¼ãƒãƒ¼ & WebSocket**: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å‘ã‘ã®APIãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡æ©Ÿèƒ½
- âœ… **ãƒ¬ãƒ¼ãƒˆåˆ¶é™æ©Ÿèƒ½**: APIå‘¼ã³å‡ºã—åˆ¶é™ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆç®¡ç†
- âœ… **è‡ªå‹•æ›´æ–°ã‚·ã‚¹ãƒ†ãƒ **: è¨­å®šã—ãŸé–“éš”ã§è‡ªå‹•çš„ã«æƒ…å ±ã‚’æ›´æ–°
- âœ… **å‹å®‰å…¨æ€§**: TypeScriptã«ã‚ˆã‚‹å®Œå…¨ãªå‹ã‚µãƒãƒ¼ãƒˆ
- âœ… **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: å …ç‰¢ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ­ã‚®ãƒ³ã‚°
- âœ… **ç’°å¢ƒå¤‰æ•°ç®¡ç†**: å®‰å…¨ãªè¨­å®šç®¡ç†

## ğŸ“‹ å¿…è¦ãªæº–å‚™

### 1. Last.fm API ã‚­ãƒ¼ã®å–å¾—

1. [Last.fm API](https://www.last.fm/api/account/create)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆï¼ˆæ—¢å­˜ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ï¼‰
3. APIç”³è«‹ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›ï¼š
   - **Application name**: ä»»æ„ï¼ˆä¾‹ï¼šDiscord Music Statusï¼‰
   - **Application description**: ä»»æ„ã®èª¬æ˜
   - **Callback URL**: `http://localhost:3000/callback`ï¼ˆãƒ€ãƒŸãƒ¼ã§OKï¼‰
   - **Application homepage**: ä»»æ„
4. API Keyã‚’ãƒ¡ãƒ¢

### 2. Discord Developer Portal ã§ã®è¨­å®š

1. [Discord Developer Portal](https://discord.com/developers/applications)ã«ã‚¢ã‚¯ã‚»ã‚¹
2. "New Application"ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šã€ŒMusic Statusã€ï¼‰
4. Application IDã‚’ãƒ¡ãƒ¢

### 3. Discord User IDã®å–å¾—

1. Discordã§é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–
2. è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å³ã‚¯ãƒªãƒƒã‚¯
3. "IDã‚’ã‚³ãƒ”ãƒ¼"ã‚’ã‚¯ãƒªãƒƒã‚¯

### 4. Discord Bot ã®ä½œæˆã¨è¨­å®š

1. [Discord Developer Portal](https://discord.com/developers/applications)ã§å‰ã«ä½œæˆã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é¸æŠ
2. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒBotã€ã‚’é¸æŠ
3. ã€ŒReset Tokenã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦Botãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆãƒ»ã‚³ãƒ”ãƒ¼
4. ã€ŒPrivileged Gateway Intentsã€ã§å¿…è¦ã«å¿œã˜ã¦æ¨©é™ã‚’è¨­å®šï¼ˆåŸºæœ¬ã¯ä¸è¦ï¼‰

### 5. Discord Bot ã‚’ã‚µãƒ¼ãƒãƒ¼ã«æ‹›å¾…

1. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ŒOAuth2ã€â†’ã€ŒURL Generatorã€ã‚’é¸æŠ
2. ã€ŒSCOPESã€ã§ã€Œbotã€ã‚’é¸æŠ
3. ã€ŒBOT PERMISSIONSã€ã§ä»¥ä¸‹ã‚’é¸æŠï¼š
   - Send Messages
   - Embed Links
   - Attach Files
   - Read Message History
4. ç”Ÿæˆã•ã‚ŒãŸURLã‹ã‚‰Botã‚’ã‚µãƒ¼ãƒãƒ¼ã«æ‹›å¾…

### 6. Discord ãƒãƒ£ãƒ³ãƒãƒ«IDã®å–å¾—

1. Discordã§é–‹ç™ºè€…ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹åŒ–
2. é€šçŸ¥ç”¨ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å³ã‚¯ãƒªãƒƒã‚¯â†’ã€ŒIDã‚’ã‚³ãƒ”ãƒ¼ã€
3. ãƒ¬ãƒãƒ¼ãƒˆç”¨ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å³ã‚¯ãƒªãƒƒã‚¯â†’ã€ŒIDã‚’ã‚³ãƒ”ãƒ¼ã€

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env.example`ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```bash
cp .env.example .env
```

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã€å–å¾—ã—ãŸæƒ…å ±ã‚’è¨­å®šï¼š

```env
LASTFM_API_KEY=your_lastfm_api_key_here
LASTFM_USERNAME=your_lastfm_username_here
DISCORD_CLIENT_ID=your_discord_application_id_here
DISCORD_USER_ID=your_discord_user_id_here
DISCORD_BOT_TOKEN=your_discord_bot_token_here
DISCORD_NOW_PLAYING_CHANNEL_ID=your_nowplaying_channel_id_here
DISCORD_REPORT_CHANNEL_ID=your_report_channel_id_here
UPDATE_INTERVAL=15000
```

### 3. ãƒ“ãƒ«ãƒ‰

```bash
npm run build
```

## ğŸ’» ä½¿ç”¨æ–¹æ³•

### é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼ˆTypeScriptç›´æ¥å®Ÿè¡Œï¼‰
```bash
npm run dev
```

### æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ“ãƒ«ãƒ‰å¾Œå®Ÿè¡Œï¼‰
```bash
npm start
```

### é–‹ç™ºæ™‚ã®ç›£è¦–ãƒ¢ãƒ¼ãƒ‰
```bash
npm run watch
```

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
discord-lastfm-nowplaying/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts          # å‹å®šç¾©
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ lastfm.ts         # Last.fm API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ discord-rpc.ts    # Discord Rich Presence ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ discord-bot.ts    # Discord Bot ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ scheduler.ts      # ãƒ¬ãƒãƒ¼ãƒˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ chart.ts          # ã‚°ãƒ©ãƒ•ç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚   â””â”€â”€ web-server.ts     # Webã‚µãƒ¼ãƒãƒ¼ãƒ»WebSocketãƒ»API
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â”œâ”€â”€ api.ts            # APIã‚¹ã‚­ãƒ¼ãƒãƒ»å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ openapi.yaml      # OpenAPIä»•æ§˜æ›¸
â”‚   â”‚   â””â”€â”€ validation.ts     # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ config.ts         # è¨­å®šç®¡ç†
â”œâ”€â”€ public/
â”‚   â””â”€â”€ test-client.html      # Webã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸
â”œâ”€â”€ dist/                     # ãƒ“ãƒ«ãƒ‰å‡ºåŠ›
â”œâ”€â”€ .env.example              # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ .env                      # ç’°å¢ƒå¤‰æ•°ï¼ˆgitignoreå¯¾è±¡ï¼‰
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

## âš™ï¸ è¨­å®š

### æ›´æ–°é–“éš”
`UPDATE_INTERVAL`ç’°å¢ƒå¤‰æ•°ã§æ›´æ–°é–“éš”ã‚’ãƒŸãƒªç§’ã§è¨­å®šã§ãã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 15ç§’ï¼‰

### APIåˆ¶é™ã¸ã®å¯¾å¿œ
- Last.fm API: 15ç§’é–“éš”ã§ãƒãƒ¼ãƒªãƒ³ã‚°ï¼ˆ1åˆ†é–“ã«4ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
- åŒä¸€æ¥½æ›²ã®é‡è¤‡æ›´æ–°ãƒ»é€šçŸ¥é˜²æ­¢
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ10ç§’ï¼‰

### Discord Bot æ©Ÿèƒ½
- **ãƒŠã‚¦ãƒ—ãƒ¬ã‚¤ãƒ³ã‚°é€šçŸ¥**: æ¥½æ›²ãŒå¤‰ã‚ã£ãŸæ™‚ã«æŒ‡å®šãƒãƒ£ãƒ³ãƒãƒ«ã«é€šçŸ¥
- **è‡ªå‹•ãƒ¬ãƒãƒ¼ãƒˆ**: 
  - æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ: æ¯æ—¥0æ™‚
  - é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆ: æ¯é€±æ—¥æ›œæ—¥0æ™‚  
  - æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆ: æ¯æœˆ1æ—¥0æ™‚

### ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆæ©Ÿèƒ½

ã‚¢ãƒ—ãƒªèµ·å‹•å¾Œã€åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã§ãã¾ã™ï¼š

#### æ±ç”¨ã‚³ãƒãƒ³ãƒ‰
```bash
# æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ
kill -USR1 $(pgrep -f "nowplaying-for-discord")

# é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆãƒ†ã‚¹ãƒˆ  
kill -USR2 $(pgrep -f "nowplaying-for-discord")
```

#### ğŸ“ˆ çµ±åˆãƒ¬ãƒãƒ¼ãƒˆç”»åƒã«ã¤ã„ã¦

ãƒ¬ãƒãƒ¼ãƒˆã«ã¯ä»¥ä¸‹ã®4ã¤ã®ã‚°ãƒ©ãƒ•ãŒ1æšã®ç™½èƒŒæ™¯ç”»åƒã¨ã—ã¦çµ±åˆã•ã‚Œã¦é€ä¿¡ã•ã‚Œã¾ã™ï¼š

1. **ãƒˆãƒƒãƒ—ãƒˆãƒ©ãƒƒã‚¯æ£’ã‚°ãƒ©ãƒ•** - æœ€ã‚‚è´ã„ãŸæ¥½æ›²ã®ä¸Šä½10æ›²ã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
2. **ãƒˆãƒƒãƒ—ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå††ã‚°ãƒ©ãƒ•** - ãŠæ°—ã«å…¥ã‚Šã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã®è´å–æ¯”ç‡ã‚’ãƒ‰ãƒ¼ãƒŠãƒ„ã‚°ãƒ©ãƒ•ã§è¡¨ç¤º
3. **è´å–æ¨ç§»ç·šã‚°ãƒ©ãƒ•** - æœŸé–“ä¸­ã®éŸ³æ¥½è´å–ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’æ™‚ç³»åˆ—ã§è¡¨ç¤º
4. **çµ±è¨ˆã‚µãƒãƒªãƒ¼æ£’ã‚°ãƒ©ãƒ•** - ç·æ¥½æ›²æ•°ã€ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆæ•°ã€ã‚¢ãƒ«ãƒãƒ æ•°ã®çµ±è¨ˆæƒ…å ±

ç”»åƒã‚µã‚¤ã‚º: 1600x1400ãƒ”ã‚¯ã‚»ãƒ«ï¼ˆé«˜è§£åƒåº¦ï¼‰
èƒŒæ™¯: ç™½è‰²ã§è¦‹ã‚„ã™ãã€Last.fmãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆä»˜ã

## ğŸŒ Webã‚µãƒ¼ãƒãƒ¼APIæ©Ÿèƒ½

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…å‘ã‘ã«Webã‚µãƒ¼ãƒãƒ¼æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

### API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `GET /health` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ãƒ»æ¥ç¶šçŠ¶æ³ç¢ºèª
- `GET /api/now-playing` - ç¾åœ¨å†ç”Ÿä¸­ã®æ¥½æ›²æƒ…å ±
- `GET /api/user-stats` - ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆæƒ…å ±ï¼ˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»No.1ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆãƒ»No.1ãƒˆãƒ©ãƒƒã‚¯ï¼‰
- `GET /api/recent-tracks` - ç›´è¿‘ã®å†ç”Ÿå±¥æ­´å–å¾—ï¼ˆä»¶æ•°æŒ‡å®šãƒ»æœŸé–“æŒ‡å®šãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
- `GET /api/reports/daily` - æ—¥æ¬¡éŸ³æ¥½ãƒ¬ãƒãƒ¼ãƒˆ
- `GET /api/reports/weekly` - é€±æ¬¡éŸ³æ¥½ãƒ¬ãƒãƒ¼ãƒˆ
- `GET /api/reports/monthly` - æœˆæ¬¡éŸ³æ¥½ãƒ¬ãƒãƒ¼ãƒˆ

### WebSocket ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡

WebSocketã‚µãƒ¼ãƒãƒ¼ï¼ˆ`ws://localhost:3001`ï¼‰ã‚’é€šã˜ã¦ä»¥ä¸‹ã®æƒ…å ±ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§é…ä¿¡ï¼š

- **NowPlayingæƒ…å ±**: æ¥½æ›²å¤‰æ›´æ™‚ã®å³åº§é€šçŸ¥
- **ãƒ¬ãƒãƒ¼ãƒˆæ›´æ–°**: å®šæœŸãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†é€šçŸ¥
- **æ¥ç¶šçŠ¶æ³**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šæ•°ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•å¾Œã€`http://localhost:3001/test-client.html` ã§ãƒ†ã‚¹ãƒˆç”¨ã®Webã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚

### è¨­å®š

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã§ä»¥ä¸‹ã®è¨­å®šãŒå¯èƒ½ï¼š

```bash
# Webã‚µãƒ¼ãƒãƒ¼è¨­å®š
HTTP_PORT=3001          # ã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3001ï¼‰
WEB_SERVER_CORS=true          # CORSæœ‰åŠ¹/ç„¡åŠ¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: trueï¼‰
```

## ğŸ”’ HTTPSè¨­å®š

### è¨¼æ˜æ›¸ã®è‡ªå‹•ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€`mkcert-auto-renewer`ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€è¨¼æ˜æ›¸ã®è‡ªå‹•ç”Ÿæˆãƒ»æ›´æ–°ãƒ»ç›£è¦–ã‚’è¡Œã„ã¾ã™ã€‚

**ä¸»ãªæ©Ÿèƒ½ï¼š**
- ğŸ”„ è¨¼æ˜æ›¸ã®è‡ªå‹•ç”Ÿæˆãƒ»æ›´æ–°
- ğŸ“ è¨¼æ˜æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ç›£è¦–
- ğŸŒ ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œï¼ˆWindowsã€macOSã€Linuxï¼‰
- ğŸ“… å®šæœŸçš„ãªè¨¼æ˜æ›¸æ›´æ–°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
- ğŸ”§ Express.js/Node.jsçµ±åˆ

### è¨¼æ˜æ›¸ã®ç”Ÿæˆ

é–‹ç™ºç’°å¢ƒã§HTTPSé€šä¿¡ã‚’æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã«ã€`mkcert`ã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«è¨¼æ˜æ›¸ã‚’ç”Ÿæˆã—ã¾ã™ï¼š

```bash
# è¨¼æ˜æ›¸ç”Ÿæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œï¼ˆæ¨å¥¨ï¼‰
npm run cert:generate

# ã¾ãŸã¯æ‰‹å‹•ã§è¨¼æ˜æ›¸ã‚’ç”Ÿæˆ
npm run cert:create

# ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ãŸCLIç”Ÿæˆ
cd lib/mkcert-auto-renewer && npm run generate
```

### HTTPSæœ‰åŠ¹åŒ–

ç’°å¢ƒå¤‰æ•°ã§HTTPSæ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ï¼š

```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
HTTPS_ENABLED=true
HTTPS_PORT=8443
HTTPS_KEY_PATH=./localhost+3-key.pem
HTTPS_CERT_PATH=./localhost+3.pem

# è¨¼æ˜æ›¸è‡ªå‹•æ›´æ–°è¨­å®š
AUTO_RENEWAL=true
CERT_WARNING_DAYS=10
CERT_CRON_PATTERN="0 2 * * 0"
HTTPS_DOMAINS=localhost,127.0.0.1,::1
```

### HTTPSã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
# é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼ˆHTTPSï¼‰
npm run dev:https

# æœ¬ç•ªãƒ¢ãƒ¼ãƒ‰ï¼ˆHTTPSï¼‰
npm run start:https

# ç›£è¦–ãƒ¢ãƒ¼ãƒ‰ï¼ˆHTTPSï¼‰
npm run watch:https
```

### è¨¼æ˜æ›¸ã®è‡ªå‹•æ›´æ–°

ã‚·ã‚¹ãƒ†ãƒ ã«ã¯ä»¥ä¸‹ã®è‡ªå‹•æ›´æ–°æ©Ÿèƒ½ãŒçµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã™ï¼š

- **è‡ªå‹•ç”Ÿæˆ**: è¨¼æ˜æ›¸ãŒå­˜åœ¨ã—ãªã„å ´åˆã€èµ·å‹•æ™‚ã«è‡ªå‹•ç”Ÿæˆ
- **æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯**: èµ·å‹•æ™‚ã«è¨¼æ˜æ›¸ã®æœ‰åŠ¹æœŸé™ã‚’ç¢ºèª
- **è‡ªå‹•æ›´æ–°**: æœ‰åŠ¹æœŸé™ãŒè¿‘ã¥ã„ãŸå ´åˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ10æ—¥å‰ï¼‰ã«è‡ªå‹•æ›´æ–°
- **å®šæœŸæ›´æ–°**: è¨­å®šã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ¯é€±æ—¥æ›œæ—¥ 2:00 AMï¼‰ã§å®šæœŸãƒã‚§ãƒƒã‚¯
- **ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–**: è¨¼æ˜æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã€å¤‰æ›´æ™‚ã«é€šçŸ¥

### æ‰‹å‹•è¨¼æ˜æ›¸ç®¡ç†

ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®CLIã‚’ä½¿ç”¨ã—ã¦æ‰‹å‹•ç®¡ç†ã‚‚å¯èƒ½ã§ã™ï¼š

```bash
# è¨¼æ˜æ›¸ã®æœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚¯
cd lib/mkcert-auto-renewer && npm run check

# è¨¼æ˜æ›¸ã®æ‰‹å‹•ç”Ÿæˆ
cd lib/mkcert-auto-renewer && npm run generate

# è¨¼æ˜æ›¸ãƒ•ã‚¡ã‚¤ãƒ«ã®ç›£è¦–
cd lib/mkcert-auto-renewer && npm run monitor

# è‡ªå‹•æ›´æ–°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«é–‹å§‹
cd lib/mkcert-auto-renewer && npm run schedule
```

### ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•

#### HTTPï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
- **WebUI**: http://localhost:3001
- **API**: http://localhost:3001/api/*
- **WebSocket**: ws://localhost:3001

#### HTTPSï¼ˆæ¨å¥¨ï¼‰
- **WebUI**: https://localhost:8443
- **API**: https://localhost:8443/api/*  
- **WebSocket**: wss://localhost:8443

å¯¾å¿œãƒ‰ãƒ¡ã‚¤ãƒ³ï¼š
- `localhost`
- `127.0.0.1`
- `192.168.40.99`ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼‰

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½

- **Helmet**: HTTPã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
- **CORS**: ã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³åˆ¶å¾¡
- **Content Security Policy**: XSSå¯¾ç­–
- **Gzipåœ§ç¸®**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
- **SSL/TLS**: æš—å·åŒ–é€šä¿¡
- **è‡ªå‹•è¨¼æ˜æ›¸æ›´æ–°**: æœŸé™åˆ‡ã‚Œé˜²æ­¢

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Discord Rich PresenceãŒè¡¨ç¤ºã•ã‚Œãªã„
- Discordã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒèµ·å‹•ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- Discord Application IDãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
- Discordã®è¨­å®šã§ã€Œã‚²ãƒ¼ãƒ ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’è¡¨ç¤ºã™ã‚‹ã€ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### Discord Boté€šçŸ¥ãŒé€ä¿¡ã•ã‚Œãªã„
- Bot TokenãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
- BotãŒã‚µãƒ¼ãƒãƒ¼ã«Joinã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
- ãƒãƒ£ãƒ³ãƒãƒ«IDãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
- Botã«å¿…è¦ãªæ¨©é™ï¼ˆSend Messages, Embed Linksç­‰ï¼‰ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

### Last.fm API ã‚¨ãƒ©ãƒ¼
- API KeyãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒæ­£ã—ã„ã“ã¨ã‚’ç¢ºèª
- Last.fmã§ScrobblingãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

### ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œãªã„
- Last.fm APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¦ã„ã‚‹ã‹ç¢ºèª
- ååˆ†ãªå†ç”Ÿå±¥æ­´ãŒã‚ã‚‹ã‹ç¢ºèªï¼ˆæ–°è¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã¯å°‘ãªã„å¯èƒ½æ€§ï¼‰

### ç’°å¢ƒå¤‰æ•°ã‚¨ãƒ©ãƒ¼
- `.env`ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
- å¿…é ˆã®ç’°å¢ƒå¤‰æ•°ãŒã™ã¹ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ISC

#### ğŸ“» å†ç”Ÿå±¥æ­´å–å¾—API

æ–°ã—ãè¿½åŠ ã•ã‚ŒãŸå†ç”Ÿå±¥æ­´å–å¾—æ©Ÿèƒ½ã§ã¯ã€Last.fm APIã®`user.getRecentTracks`ã‚’æ´»ç”¨ã—ã¦ã€æŒ‡å®šã—ãŸä»¶æ•°ã®ç›´è¿‘ã®å†ç”Ÿå±¥æ­´ã‚’å–å¾—ã§ãã¾ã™ã€‚

**åŸºæœ¬çš„ãªä½¿ç”¨ä¾‹:**

```bash
# ç›´è¿‘10ä»¶ã®å†ç”Ÿå±¥æ­´ã‚’å–å¾—
curl "http://localhost:3001/api/recent-tracks?limit=10"

# æœŸé–“æŒ‡å®šã§å–å¾—ï¼ˆæ˜¨æ—¥ã®å†ç”Ÿå±¥æ­´ï¼‰
curl "http://localhost:3001/api/recent-tracks?from=2025-07-05T00:00:00.000Z&to=2025-07-05T23:59:59.999Z"

# ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2ãƒšãƒ¼ã‚¸ç›®ã‚’å–å¾—ï¼‰
curl "http://localhost:3001/api/recent-tracks?page=2&limit=50"
```

**JavaScript/TypeScript ã§ã®ä½¿ç”¨ä¾‹:**

```javascript
// ç›´è¿‘20ä»¶ã®å†ç”Ÿå±¥æ­´ã‚’å–å¾—
const response = await fetch('/api/recent-tracks?limit=20');
const data = await response.json();

if (data.success) {
  console.log(`${data.data.tracks.length}ä»¶ã®å†ç”Ÿå±¥æ­´ã‚’å–å¾—`);
  data.data.tracks.forEach(track => {
    console.log(`${track.artist} - ${track.track} (${track.isPlaying ? 'å†ç”Ÿä¸­' : track.playedAt})`);
  });
}

// æœŸé–“æŒ‡å®šã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const fromDate = '2025-07-01T00:00:00.000Z';
const toDate = '2025-07-06T23:59:59.999Z';
const periodicResponse = await fetch(
  `/api/recent-tracks?from=${fromDate}&to=${toDate}&limit=200`
);
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»•æ§˜:**
- `limit`: å–å¾—ä»¶æ•°ï¼ˆ1-200ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ50ï¼‰
- `page`: ãƒšãƒ¼ã‚¸ç•ªå·ï¼ˆ1ä»¥ä¸Šã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1ï¼‰
- `from`: é–‹å§‹æ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰
- `to`: çµ‚äº†æ—¥æ™‚ï¼ˆISO 8601å½¢å¼ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "success": true,
  "data": {
    "tracks": [
      {
        "artist": "Artist Name",
        "track": "Song Title",
        "album": "Album Name",
        "imageUrl": "https://...",
        "isPlaying": false,
        "playedAt": "2025-07-06T10:25:00.000Z",
        "url": "https://www.last.fm/music/..."
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 50,
      "total": 10
    },
    "period": {
      "from": "2025-07-01T00:00:00.000Z",
      "to": "2025-07-06T23:59:59.999Z"
    }
  },
  "timestamp": "2025-07-06T10:30:00.000Z"
}
```

**æ³¨æ„äº‹é …:**
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™: 1åˆ†é–“ã«100ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¾ã§
- ç¾åœ¨å†ç”Ÿä¸­ã®ãƒˆãƒ©ãƒƒã‚¯ã¯`isPlaying: true`ã§ã€`playedAt`ã¯`null`
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯é©åˆ‡ãªHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™
