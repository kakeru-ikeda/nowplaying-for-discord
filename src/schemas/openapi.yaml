openapi: 3.0.3
info:
  title: Discord Last.fm Now Playing Bot - 踏み台サーバーAPI
  description: |
    Last.fm APIを使用してDiscordのリッチプレゼンスに現在再生中の楽曲を表示し、
    Discord Botでチャンネル通知と統計レポートを送信するアプリケーションの踏み台サーバーAPI。
    
    ## 機能
    - 現在再生中の楽曲情報の取得
    - 直近の再生履歴の取得（件数指定・期間指定・ページネーション対応）
    - 音楽レポートの取得（日次・週次・月次・ページネーション対応）
    - WebSocketによるリアルタイム通信
    - ヘルスチェック機能
    - レート制限機能（1分間100リクエスト）
    
    ## ページネーション機能
    レポートAPIは以下のページネーション機能をサポートしています：
    - `limit`: 1ページあたりの取得件数（1-200、デフォルト50）
    - `page`: ページ番号（1以上、デフォルト1）
    - `date`: 基準日指定（ISO 8601形式またはYYYY-MM-DD形式）
    
    レスポンスにはページネーション情報が含まれ、各データタイプ（トラック・アーティスト・アルバム）の総件数と総ページ数が提供されます。
    
    ## WebSocket
    WebSocket接続: `ws://localhost:3001`
    
    リアルタイムで以下の情報を受信できます：
    - 楽曲変更通知
    - レポート生成状況
    - 接続ステータス
  version: 1.0.0
  contact:
    name: Discord Last.fm Now Playing Bot
    url: https://github.com/kakeru-ikeda/nowplaying-for-discord
  license:
    name: MIT
servers:
  - url: http://localhost:3001
    description: ローカル開発サーバー

paths:
  # ヘルスチェック
  /health:
    get:
      summary: ヘルスチェック
      description: サーバーの動作状況とサービスの稼働状態を確認
      operationId: getHealth
      responses:
        '200':
          description: サーバーは正常に動作中
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthCheckResponse'
              example:
                status: "ok"
                timestamp: "2025-07-06T10:30:00.000Z"
                uptime: 3600
                version: "1.0.0"
                services:
                  lastfm: true
                  discord: true
                  websocket: true

  # ナウプレイング情報
  /api/now-playing:
    get:
      summary: 現在再生中の楽曲情報取得
      description: Last.fm APIから現在再生中の楽曲情報を取得
      operationId: getNowPlaying
      responses:
        '200':
          description: 楽曲情報の取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NowPlayingApiResponse'
              examples:
                playing:
                  summary: 楽曲再生中
                  value:
                    success: true
                    data:
                      artist: "スリーズブーケ"
                      track: "恋景色昭和ロマン"
                      album: "アルバム名"
                      imageUrl: "https://lastfm.freetls.fastly.net/i/u/300x300/example.png"
                      isPlaying: true
                    timestamp: "2025-07-06T10:30:00.000Z"
                not_playing:
                  summary: 楽曲停止中
                  value:
                    success: true
                    data:
                      artist: ""
                      track: ""
                      isPlaying: false
                    timestamp: "2025-07-06T10:30:00.000Z"
        '500':
          description: Last.fm API取得エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  # 日次レポート
  /api/reports/daily:
    get:
      summary: 日次音楽レポート取得
      description: 過去7日間の音楽聴取データとトップトラック・アーティスト情報を取得（グラフなし）
      operationId: getDailyReport
      parameters:
        - name: format
          in: query
          description: レスポンス形式
          required: false
          schema:
            type: string
            enum: [json, summary]
            default: json
        - name: date
          in: query
          description: 取得する日次レポートの基準日（YYYY-MM-DD形式またはISO 8601形式）。指定しない場合は現在の日付が使用されます。
          required: false
          schema:
            type: string
            format: date
          example: "2023-07-10"
        - name: limit
          in: query
          description: 取得件数（1-200、デフォルト50）
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - name: page
          in: query
          description: ページ番号（1以上、デフォルト1）
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
      responses:
        '200':
          description: 日次レポートの取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MusicReportApiResponse'
              example:
                success: true
                data:
                  period: "daily"
                  topTracks:
                    - name: "楽曲名1"
                      playcount: "15"
                      artist:
                        name: "アーティスト1"
                    - name: "楽曲名2"
                      playcount: "10"
                      artist:
                        name: "アーティスト2"
                  topArtists:
                    - name: "アーティスト1"
                      playcount: "25"
                    - name: "アーティスト2"
                      playcount: "18"
                  topAlbums:
                    - name: "アルバム1"
                      playcount: "12"
                      artist:
                        name: "アーティスト1"
                  username: "lastfmユーザー名"
                  dateRange:
                    start: "2023-07-04"
                    end: "2023-07-10"
                  listeningTrends:
                    - date: "2023-07-04"
                      scrobbles: 35
                      label: "7/4"
                    - date: "2023-07-05"
                      scrobbles: 42
                      label: "7/5"
                  reportDate:
                    startDate: "2023-07-04"
                    endDate: "2023-07-10"
                    targetDate: "2023-07-10"
                  pagination:
                    page: 1
                    limit: 50
                    totalTracks: 25
                    totalArtists: 15
                    totalAlbums: 12
                    totalPagesForTracks: 1
                    totalPagesForArtists: 1
                    totalPagesForAlbums: 1
                timestamp: "2023-07-10T23:59:59.000Z"
        '400':
          description: 不正なリクエストパラメータ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Invalid date format. Please use ISO 8601 format (YYYY-MM-DD)"
                code: "INVALID_REQUEST"
                timestamp: "2023-07-10T10:30:00.000Z"
        '500':
          description: レポート生成エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Failed to generate daily report"
                code: "REPORT_GENERATION_FAILED"
                timestamp: "2023-07-10T10:30:00.000Z"

  # 週次レポート
  /api/reports/weekly:
    get:
      summary: 週次音楽レポート取得
      description: 過去4週間の音楽聴取データとトップトラック・アーティスト情報を取得（グラフなし）
      operationId: getWeeklyReport
      parameters:
        - name: format
          in: query
          description: レスポンス形式
          required: false
          schema:
            type: string
            enum: [json, summary]
            default: json
        - name: date
          in: query
          description: 取得する週次レポートの基準日（YYYY-MM-DD形式またはISO 8601形式）。指定しない場合は現在の日付が使用されます。
          required: false
          schema:
            type: string
            format: date
          example: "2023-07-10"
        - name: limit
          in: query
          description: 取得件数（1-200、デフォルト50）
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - name: page
          in: query
          description: ページ番号（1以上、デフォルト1）
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
      responses:
        '200':
          description: 週次レポートの取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MusicReportApiResponse'
              example:
                success: true
                data:
                  period: "weekly"
                  topTracks:
                    - name: "楽曲名1"
                      playcount: "32"
                      artist:
                        name: "アーティスト1"
                    - name: "楽曲名2"
                      playcount: "25"
                      artist:
                        name: "アーティスト2"
                  topArtists:
                    - name: "アーティスト1"
                      playcount: "85"
                    - name: "アーティスト2"
                      playcount: "76"
                  topAlbums:
                    - name: "アルバム1"
                      playcount: "45"
                      artist:
                        name: "アーティスト1"
                  username: "lastfmユーザー名"
                  dateRange:
                    start: "2023-06-12"
                    end: "2023-07-10"
                  listeningTrends:
                    - date: "2023-06-12"
                      scrobbles: 210
                      label: "6/12-6/18"
                    - date: "2023-06-19"
                      scrobbles: 235
                      label: "6/19-6/25"
                    - date: "2023-06-26"
                      scrobbles: 180
                      label: "6/26-7/2"
                    - date: "2023-07-03"
                      scrobbles: 265
                      label: "7/3-7/10"
                  reportDate:
                    startDate: "2023-06-12"
                    endDate: "2023-07-10"
                    targetDate: "2023-07-10"
                  pagination:
                    page: 1
                    limit: 50
                    totalTracks: 78
                    totalArtists: 42
                    totalAlbums: 35
                    totalPagesForTracks: 2
                    totalPagesForArtists: 1
                    totalPagesForAlbums: 1
                timestamp: "2023-07-10T23:59:59.000Z"
        '400':
          description: 不正なリクエストパラメータ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Invalid date format. Please use ISO 8601 format (YYYY-MM-DD)"
                code: "INVALID_REQUEST"
                timestamp: "2023-07-10T10:30:00.000Z"
        '500':
          description: レポート生成エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Failed to generate weekly report"
                code: "REPORT_GENERATION_FAILED"
                timestamp: "2023-07-10T10:30:00.000Z"

  # 月次レポート
  /api/reports/monthly:
    get:
      summary: 月次音楽レポート取得
      description: 過去6ヶ月の音楽聴取データとトップトラック・アーティスト情報を取得（グラフなし）
      operationId: getMonthlyReport
      parameters:
        - name: format
          in: query
          description: レスポンス形式
          required: false
          schema:
            type: string
            enum: [json, summary]
            default: json
        - name: date
          in: query
          description: 取得する月次レポートの基準日（YYYY-MM-DD形式またはISO 8601形式）。指定しない場合は現在の日付が使用されます。
          required: false
          schema:
            type: string
            format: date
          example: "2023-07-01"
        - name: limit
          in: query
          description: 取得件数（1-200、デフォルト50）
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - name: page
          in: query
          description: ページ番号（1以上、デフォルト1）
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
      responses:
        '200':
          description: 月次レポートの取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MusicReportApiResponse'
              example:
                success: true
                data:
                  period: "monthly"
                  topTracks:
                    - name: "楽曲名1"
                      playcount: "68"
                      artist:
                        name: "アーティスト1"
                    - name: "楽曲名2"
                      playcount: "52"
                      artist:
                        name: "アーティスト2"
                  topArtists:
                    - name: "アーティスト1"
                      playcount: "245"
                    - name: "アーティスト2"
                      playcount: "190"
                  topAlbums:
                    - name: "アルバム1"
                      playcount: "110"
                      artist:
                        name: "アーティスト1"
                  username: "lastfmユーザー名"
                  dateRange:
                    start: "2023-02-01"
                    end: "2023-07-01"
                  listeningTrends:
                    - date: "2023-02-01"
                      scrobbles: 820
                      label: "2月"
                    - date: "2023-03-01"
                      scrobbles: 750
                      label: "3月"
                    - date: "2023-04-01"
                      scrobbles: 910
                      label: "4月"
                    - date: "2023-05-01"
                      scrobbles: 880
                      label: "5月"
                    - date: "2023-06-01"
                      scrobbles: 950
                      label: "6月"
                    - date: "2023-07-01"
                      scrobbles: 480
                      label: "7月"
                  reportDate:
                    startDate: "2023-02-01"
                    endDate: "2023-07-01"
                    targetDate: "2023-07-01"
                  pagination:
                    page: 1
                    limit: 50
                    totalTracks: 125
                    totalArtists: 68
                    totalAlbums: 45
                    totalPagesForTracks: 3
                    totalPagesForArtists: 2
                    totalPagesForAlbums: 1
                timestamp: "2023-07-01T23:59:59.000Z"
        '400':
          description: 不正なリクエストパラメータ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Invalid date format. Please use ISO 8601 format (YYYY-MM-DD)"
                code: "INVALID_REQUEST"
                timestamp: "2023-07-01T10:30:00.000Z"
        '500':
          description: レポート生成エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Failed to generate monthly report"
                code: "REPORT_GENERATION_FAILED"
                timestamp: "2023-07-01T10:30:00.000Z"

  # 再生履歴取得
  /api/recent-tracks:
    get:
      summary: 直近の再生履歴取得
      description: |
        Last.fm APIから指定した件数の直近の再生履歴を取得。
        現在再生中の楽曲も含まれ、期間指定やページネーションに対応。
      operationId: getRecentTracks
      parameters:
        - name: limit
          in: query
          description: 取得件数（1-200、デフォルト50）
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
        - name: page
          in: query
          description: ページ番号（デフォルト1）
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: from
          in: query
          description: 開始日時（ISO 8601形式：YYYY-MM-DDTHH:mm:ss.sssZ）
          required: false
          schema:
            type: string
            format: date-time
          example: "2025-07-01T00:00:00.000Z"
        - name: to
          in: query
          description: 終了日時（ISO 8601形式：YYYY-MM-DDTHH:mm:ss.sssZ）
          required: false
          schema:
            type: string
            format: date-time
          example: "2025-07-06T23:59:59.999Z"
      responses:
        '200':
          description: 再生履歴の取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecentTracksApiResponse'
              examples:
                recent_tracks:
                  summary: 直近の再生履歴
                  value:
                    success: true
                    data:
                      tracks:
                        - artist: "スリーズブーケ"
                          track: "恋景色昭和ロマン"
                          album: "アルバム名"
                          imageUrl: "https://lastfm.freetls.fastly.net/i/u/300x300/example.png"
                          isPlaying: true
                          url: "https://www.last.fm/music/..."
                        - artist: "Artist Name"
                          track: "Previous Track"
                          album: "Album Name"
                          imageUrl: "https://lastfm.freetls.fastly.net/i/u/300x300/example2.png"
                          isPlaying: false
                          playedAt: "2025-07-06T10:25:00.000Z"
                          url: "https://www.last.fm/music/..."
                      pagination:
                        page: 1
                        limit: 50
                        total: 2
                      period:
                        from: "2025-07-01T00:00:00.000Z"
                        to: "2025-07-06T23:59:59.999Z"
                    timestamp: "2025-07-06T10:30:00.000Z"
        '400':
          description: 不正なリクエストパラメータ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              examples:
                invalid_limit:
                  summary: 不正なlimitパラメータ
                  value:
                    success: false
                    error: "Invalid limit. Must be between 1 and 200"
                    code: "INVALID_REQUEST"
                    timestamp: "2025-07-06T10:30:00.000Z"
                invalid_date:
                  summary: 不正な日付形式
                  value:
                    success: false
                    error: "Invalid from date format. Use ISO 8601 format (YYYY-MM-DDTHH:mm:ss.sssZ)"
                    code: "INVALID_REQUEST"
                    timestamp: "2025-07-06T10:30:00.000Z"
        '429':
          description: レート制限エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Rate limit exceeded"
                code: "RATE_LIMIT_EXCEEDED"
                timestamp: "2025-07-06T10:30:00.000Z"
        '500':
          description: Last.fm API取得エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'

  # ユーザー統計情報
  /api/user-stats:
    get:
      summary: ユーザー統計情報取得
      description: Last.fm APIからユーザーの基本情報とNo.1アーティスト・トラック情報を取得
      operationId: getUserStats
      responses:
        '200':
          description: ユーザー統計情報の取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserStatsApiResponse'
              example:
                success: true
                data:
                  profile:
                    username: "username"
                    realName: "Real Name"
                    url: "https://www.last.fm/user/username"
                    country: "Japan"
                    registeredDate: "2015-01-01 00:00"
                    totalPlayCount: 12345
                    profileImage: "https://lastfm.freetls.fastly.net/i/u/300x300/example.png"
                  topArtist:
                    name: "アーティスト名"
                    playCount: 500
                    url: "https://www.last.fm/music/artist"
                    image: "https://lastfm.freetls.fastly.net/i/u/300x300/artist.png"
                  topTrack:
                    name: "楽曲名"
                    artist: "アーティスト名"
                    playCount: 100
                    url: "https://www.last.fm/music/track"
                    image: "https://lastfm.freetls.fastly.net/i/u/300x300/track.png"
                  generatedAt: "2025-07-06T10:30:00.000Z"
                timestamp: "2025-07-06T10:30:00.000Z"
        '500':
          description: ユーザー統計情報取得エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error: "Failed to fetch user statistics"
                timestamp: "2025-07-06T10:30:00.000Z"

  # 週間日別統計API
  /api/stats/week-daily:
    get:
      summary: 週間日別統計取得
      description: 指定した週の各日の再生数を取得します
      operationId: getWeekDailyStats
      parameters:
        - name: date
          in: query
          description: 取得する週の基準日（YYYY-MM-DD形式）。指定しない場合は現在の日付が使用されます。
          required: false
          schema:
            type: string
            format: date
          example: "2023-07-10"
      responses:
        '200':
          description: 週間日別統計の取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WeekDailyStatsApiResponse'
              example:
                success: true
                data:
                  stats:
                    - date: "2023-07-10"
                      scrobbles: 45
                      dayOfWeek: 1
                      label: "7月10日(月)"
                    - date: "2023-07-11"
                      scrobbles: 32
                      dayOfWeek: 2
                      label: "7月11日(火)"
                    - date: "2023-07-12"
                      scrobbles: 28
                      dayOfWeek: 3
                      label: "7月12日(水)"
                    - date: "2023-07-13"
                      scrobbles: 50
                      dayOfWeek: 4
                      label: "7月13日(木)"
                    - date: "2023-07-14"
                      scrobbles: 62
                      dayOfWeek: 5
                      label: "7月14日(金)"
                    - date: "2023-07-15"
                      scrobbles: 75
                      dayOfWeek: 6
                      label: "7月15日(土)"
                    - date: "2023-07-16"
                      scrobbles: 55
                      dayOfWeek: 0
                      label: "7月16日(日)"
                  meta:
                    total: 347
                    period: "week"
                    referenceDate: "2023-07-10"
                timestamp: "2023-07-16T23:59:59.000Z"
        '400':
          description: 不正なリクエストパラメータ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Invalid date format. Please use ISO 8601 format (YYYY-MM-DD)"
                code: "INVALID_REQUEST"
                timestamp: "2023-07-16T23:59:59.000Z"
        '500':
          description: 統計情報取得エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Failed to fetch weekly detailed statistics"
                code: "LASTFM_API_ERROR"
                timestamp: "2023-07-16T23:59:59.000Z"

  # 月間週別統計API
  /api/stats/month-weekly:
    get:
      summary: 月間週別統計取得
      description: 指定した月の各週の再生数を取得します
      operationId: getMonthWeeklyStats
      parameters:
        - name: date
          in: query
          description: 取得する月の基準日（YYYY-MM-DD形式）。指定しない場合は現在の日付が使用されます。
          required: false
          schema:
            type: string
            format: date
          example: "2023-07-01"
      responses:
        '200':
          description: 月間週別統計の取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MonthWeeklyStatsApiResponse'
              example:
                success: true
                data:
                  stats:
                    - startDate: "2023-07-01"
                      endDate: "2023-07-07"
                      scrobbles: 320
                      weekNumber: 1
                      label: "7/1-7/7"
                    - startDate: "2023-07-08"
                      endDate: "2023-07-14"
                      scrobbles: 285
                      weekNumber: 2
                      label: "7/8-7/14"
                    - startDate: "2023-07-15"
                      endDate: "2023-07-21"
                      scrobbles: 410
                      weekNumber: 3
                      label: "7/15-7/21"
                    - startDate: "2023-07-22"
                      endDate: "2023-07-28"
                      scrobbles: 325
                      weekNumber: 4
                      label: "7/22-7/28"
                    - startDate: "2023-07-29"
                      endDate: "2023-07-31"
                      scrobbles: 150
                      weekNumber: 5
                      label: "7/29-7/31"
                  meta:
                    total: 1490
                    period: "month"
                    month: 7
                    year: 2023
                    label: "2023年7月"
                    referenceDate: "2023-07-01"
                timestamp: "2023-07-31T23:59:59.000Z"
        '400':
          description: 不正なリクエストパラメータ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Invalid date format. Please use ISO 8601 format (YYYY-MM-DD)"
                code: "INVALID_REQUEST"
                timestamp: "2023-07-31T23:59:59.000Z"
        '500':
          description: 統計情報取得エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Failed to fetch monthly detailed statistics"
                code: "LASTFM_API_ERROR"
                timestamp: "2023-07-31T23:59:59.000Z"

  # 年間月別統計API
  /api/stats/year-monthly:
    get:
      summary: 年間月別統計取得
      description: 指定した年の各月の再生数を取得します
      operationId: getYearMonthlyStats
      parameters:
        - name: year
          in: query
          description: 取得する年（YYYY形式）。指定しない場合は現在の年が使用されます。
          required: false
          schema:
            type: string
            pattern: "^\\d{4}$"
          example: "2023"
      responses:
        '200':
          description: 年間月別統計の取得成功
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/YearMonthlyStatsApiResponse'
              example:
                success: true
                data:
                  stats:
                    - year: 2023
                      month: 1
                      scrobbles: 1250
                      startDate: "2023-01-01"
                      endDate: "2023-01-31"
                      label: "1月"
                    - year: 2023
                      month: 2
                      scrobbles: 980
                      startDate: "2023-02-01"
                      endDate: "2023-02-28"
                      label: "2月"
                    - year: 2023
                      month: 3
                      scrobbles: 1320
                      startDate: "2023-03-01"
                      endDate: "2023-03-31"
                      label: "3月"
                    - year: 2023
                      month: 4
                      scrobbles: 1150
                      startDate: "2023-04-01"
                      endDate: "2023-04-30"
                      label: "4月"
                    - year: 2023
                      month: 5
                      scrobbles: 1420
                      startDate: "2023-05-01"
                      endDate: "2023-05-31"
                      label: "5月"
                    - year: 2023
                      month: 6
                      scrobbles: 1380
                      startDate: "2023-06-01"
                      endDate: "2023-06-30"
                      label: "6月"
                    - year: 2023
                      month: 7
                      scrobbles: 1490
                      startDate: "2023-07-01"
                      endDate: "2023-07-31"
                      label: "7月"
                  meta:
                    total: 8990
                    period: "year"
                    year: 2023
                    label: "2023年"
                timestamp: "2023-07-31T23:59:59.000Z"
        '400':
          description: 不正なリクエストパラメータ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Invalid year format. Please use YYYY format"
                code: "INVALID_REQUEST"
                timestamp: "2023-07-31T23:59:59.000Z"
        '500':
          description: 統計情報取得エラー
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiErrorResponse'
              example:
                success: false
                error: "Failed to fetch yearly detailed statistics"
                code: "LASTFM_API_ERROR"
                timestamp: "2023-07-31T23:59:59.000Z"
components:
  schemas:
    # 基本レスポンス
    BaseApiResponse:
      type: object
      properties:
        success:
          type: boolean
          description: APIの実行結果
        timestamp:
          type: string
          format: date-time
          description: レスポンス生成時刻（ISO 8601形式）
      required:
        - success
        - timestamp

    # ヘルスチェック
    HealthCheckResponse:
      allOf:
        - $ref: '#/components/schemas/BaseApiResponse'
        - type: object
          properties:
            status:
              type: string
              enum: [ok, error]
              description: サーバーステータス
            uptime:
              type: number
              description: サーバー稼働時間（秒）
            version:
              type: string
              description: アプリケーションバージョン
            services:
              type: object
              properties:
                lastfm:
                  type: boolean
                  description: Last.fm API接続状態
                discord:
                  type: boolean
                  description: Discord Bot接続状態
                websocket:
                  type: boolean
                  description: WebSocketサーバー稼働状態
          required:
            - status

    # 楽曲情報
    NowPlayingInfo:
      type: object
      properties:
        artist:
          type: string
          description: アーティスト名
        track:
          type: string
          description: 楽曲名
        album:
          type: string
          description: アルバム名
        imageUrl:
          type: string
          format: uri
          description: アルバムアートワークURL
        isPlaying:
          type: boolean
          description: 再生状態
      required:
        - artist
        - track
        - isPlaying

    # ナウプレイングAPIレスポンス
    NowPlayingApiResponse:
      allOf:
        - $ref: '#/components/schemas/BaseApiResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/NowPlayingInfo'

    # 聴取推移データ
    ListeningTrendData:
      type: object
      properties:
        date:
          type: string
          format: date
          description: 日付（YYYY-MM-DD形式）
        scrobbles:
          type: integer
          description: その期間の聴取回数
        label:
          type: string
          description: 表示用ラベル
      required:
        - date
        - scrobbles
        - label

    # トップトラック
    TopTrack:
      type: object
      properties:
        name:
          type: string
          description: 楽曲名
        artist:
          type: object
          properties:
            name:
              type: string
              description: アーティスト名
        playcount:
          type: string
          description: 再生回数
        image:
          type: array
          items:
            type: object
            properties:
              '#text':
                type: string
                format: uri
              size:
                type: string
                enum: [small, medium, large, extralarge]

    # 音楽レポート
    MusicReport:
      type: object
      properties:
        period:
          type: string
          enum: [daily, weekly, monthly]
          description: レポート期間
        topTracks:
          type: array
          items:
            $ref: '#/components/schemas/TopTrack'
          description: トップトラック
        topArtists:
          type: array
          items:
            type: object
          description: トップアーティスト
        topAlbums:
          type: array
          items:
            type: object
          description: トップアルバム
        username:
          type: string
          description: Last.fmユーザー名
        dateRange:
          type: object
          properties:
            start:
              type: string
              description: 開始日
            end:
              type: string
              description: 終了日
        listeningTrends:
          type: array
          items:
            $ref: '#/components/schemas/ListeningTrendData'
          description: 聴取推移データ
        reportDate:
          type: object
          properties:
            startDate:
              type: string
              format: date
              description: レポート期間の開始日
            endDate:
              type: string
              format: date
              description: レポート期間の終了日
            targetDate:
              type: string
              format: date
              nullable: true
              description: 指定された基準日（指定がない場合はnull）
          description: レポートの詳細日付情報
        pagination:
          type: object
          properties:
            page:
              type: integer
              description: 現在のページ番号
            limit:
              type: integer
              description: 1ページあたりの取得件数
            totalTracks:
              type: integer
              description: トラックの総件数
            totalArtists:
              type: integer
              description: アーティストの総件数
            totalAlbums:
              type: integer
              description: アルバムの総件数
            totalPagesForTracks:
              type: integer
              description: トラックの総ページ数
            totalPagesForArtists:
              type: integer
              description: アーティストの総ページ数
            totalPagesForAlbums:
              type: integer
              description: アルバムの総ページ数
          required:
            - page
            - limit
            - totalTracks
            - totalArtists
            - totalAlbums
            - totalPagesForTracks
            - totalPagesForArtists
            - totalPagesForAlbums
          description: ページネーション情報
      required:
        - period
        - topTracks
        - topArtists
        - topAlbums
        - username
        - dateRange
        - listeningTrends
        - pagination

    # 音楽レポートAPIレスポンス
    MusicReportApiResponse:
      allOf:
        - $ref: '#/components/schemas/BaseApiResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/MusicReport'

    # エラーレスポンス
    ApiErrorResponse:
      allOf:
        - $ref: '#/components/schemas/BaseApiResponse'
        - type: object
          properties:
            success:
              type: boolean
              enum: [false]
            error:
              type: string
              description: エラーメッセージ
            code:
              type: string
              description: エラーコード
            details:
              type: object
              description: エラー詳細情報
          required:
            - error

    # WebSocketメッセージ
    WebSocketMessage:
      type: object
      properties:
        type:
          type: string
          enum: [now-playing, report-update, connection-status, error, ping, pong]
          description: メッセージタイプ
        data:
          type: object
          description: メッセージデータ
        timestamp:
          type: string
          format: date-time
          description: メッセージ生成時刻
        id:
          type: string
          description: メッセージID（オプション）
      required:
        - type
        - data
        - timestamp

    # 再生履歴情報
    RecentTrackInfo:
      type: object
      properties:
        artist:
          type: string
          description: アーティスト名
        track:
          type: string
          description: 楽曲名
        album:
          type: string
          description: アルバム名
        imageUrl:
          type: string
          format: uri
          description: アルバムアートワークURL
        isPlaying:
          type: boolean
          description: 現在再生中かどうか
        playedAt:
          type: string
          format: date-time
          description: 再生日時（現在再生中の場合はnull）
        url:
          type: string
          format: uri
          description: Last.fm楽曲ページURL
      required:
        - artist
        - track
        - isPlaying

    # 再生履歴レスポンス
    RecentTracksApiResponse:
      allOf:
        - $ref: '#/components/schemas/BaseApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                tracks:
                  type: array
                  items:
                    $ref: '#/components/schemas/RecentTrackInfo'
                  description: 再生履歴の配列
                pagination:
                  type: object
                period:
                  type: object
              required:
                - tracks
                - pagination
    
    # 週間日別統計項目
    DailyStatsItem:
      type: object
      properties:
        date:
          type: string
          format: date
          description: ISO形式の日付 (YYYY-MM-DD)
        scrobbles:
          type: integer
          description: その日の再生数
        dayOfWeek:
          type: integer
          minimum: 0
          maximum: 6
          description: 曜日 (0: 日曜日, 1: 月曜日, ... 6: 土曜日)
        label:
          type: string
          description: 表示用ラベル (例: '7月10日(水)')
      required:
        - date
        - scrobbles
        - dayOfWeek
        - label
    
    # 月間週別統計項目
    WeeklyStatsItem:
      type: object
      properties:
        startDate:
          type: string
          format: date
          description: 週の開始日 (YYYY-MM-DD)
        endDate:
          type: string
          format: date
          description: 週の終了日 (YYYY-MM-DD)
        scrobbles:
          type: integer
          description: その週の再生数
        weekNumber:
          type: integer
          minimum: 1
          description: 月内の週番号 (1から始まる)
        label:
          type: string
          description: 表示用ラベル (例: '7/1-7/7')
      required:
        - startDate
        - endDate
        - scrobbles
        - weekNumber
        - label
    
    # 年間月別統計項目
    MonthlyStatsItem:
      type: object
      properties:
        year:
          type: integer
          description: 年
        month:
          type: integer
          minimum: 1
          maximum: 12
          description: 月 (1-12)
        scrobbles:
          type: integer
          description: その月の再生数
        startDate:
          type: string
          format: date
          description: 月の開始日 (YYYY-MM-DD)
        endDate:
          type: string
          format: date
          description: 月の終了日 (YYYY-MM-DD)
        label:
          type: string
          description: 表示用ラベル (例: '7月')
      required:
        - year
        - month
        - scrobbles
        - startDate
        - endDate
        - label
    
    # 週間日別統計APIレスポンス
    WeekDailyStatsApiResponse:
      allOf:
        - $ref: '#/components/schemas/BaseApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                stats:
                  type: array
                  items:
                    $ref: '#/components/schemas/DailyStatsItem'
                  description: 週の各日の再生数統計
                meta:
                  type: object
                  properties:
                    total:
                      type: integer
                      description: 週の総再生数
                    period:
                      type: string
                      enum: [week]
                      description: 統計期間タイプ
                    referenceDate:
                      type: string
                      format: date
                      description: 基準日
                  required:
                    - total
                    - period
                    - referenceDate
              required:
                - stats
                - meta
    
    # 月間週別統計APIレスポンス
    MonthWeeklyStatsApiResponse:
      allOf:
        - $ref: '#/components/schemas/BaseApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                stats:
                  type: array
                  items:
                    $ref: '#/components/schemas/WeeklyStatsItem'
                  description: 月の各週の再生数統計
                meta:
                  type: object
                  properties:
                    total:
                      type: integer
                      description: 月の総再生数
                    period:
                      type: string
                      enum: [month]
                      description: 統計期間タイプ
                    month:
                      type: integer
                      minimum: 1
                      maximum: 12
                      description: 月 (1-12)
                    year:
                      type: integer
                      description: 年
                    label:
                      type: string
                      description: 表示用ラベル (例: '2023年7月')
                    referenceDate:
                      type: string
                      format: date
                      description: 基準日
                  required:
                    - total
                    - period
                    - month
                    - year
                    - label
                    - referenceDate
              required:
                - stats
                - meta
    
    # 年間月別統計APIレスポンス
    YearMonthlyStatsApiResponse:
      allOf:
        - $ref: '#/components/schemas/BaseApiResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                stats:
                  type: array
                  items:
                    $ref: '#/components/schemas/MonthlyStatsItem'
                  description: 年の各月の再生数統計
                meta:
                  type: object
                  properties:
                    total:
                      type: integer
                      description: 年の総再生数
                    period:
                      type: string
                      enum: [year]
                      description: 統計期間タイプ
                    year:
                      type: integer
                      description: 年
                    label:
                      type: string
                      description: 表示用ラベル (例: '2023年')
                  required:
                    - total
                    - period
                    - year
                    - label
              required:
                - stats
                - meta
    
    # ユーザー統計情報APIレスポンス
    UserStatsApiResponse:
      allOf:
        - $ref: '#/components/schemas/BaseApiResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/UserStats'
